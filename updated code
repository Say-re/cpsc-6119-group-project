//Author: Kelly Payne 10/5/25
public class HardCandy implements Candy{
	private String name;
	private double price;
	private int quantity;
	private double weight;
	
	public HardCandy(String name, double price, double weight, int quantity) {
		this.name = name;
		this.price = price;
		this.quantity = quantity;
		this.weight = weight;
	}
	@Override
    public String getName() {
        return name ;
    }
    public double getWeight(){
        return weight;
    }
    public double getPrice(){ 
        return price;
    }
    @Override
    public int getQuantity() {
    	return quantity;
    }
    @Override
    public void setPrice(double price) {
    	this.price = price;
    }
    @Override
    public void prepare() {
        System.out.println("This is hard candy.");
    }
}


public class HardCandyBag implements CandyPackage{
	private double price = 2.00;
    @Override 
    public void pack(Candy candy){
        System.out.println("Packing " + candy.getName() + " is in a clear plastic bag.");
    }
    @Override
    public double getPrice(){
        return price;
    }

}


public class HardCandyFactory implements CandyFactory{
	@Override
    public Candy createCandy(){
        return new BaseCandy("Hard", 1.75, .05, 20);
    }
	@Override Candy createCandy(double price) {
		return new BaseCandy("Gummy", price, .05, 20);
	}
    @Override
    public CandyPackage createPackage(){
        return new HardCandyBag();
    }
}

//Author: Kelly Payne
// Shopping Cart and Data Holder
import java.util.*;
public class ShoppingCart {
	private List<Candy> items = new ArrayList<>();
	private List<CandyPackage> packages = new ArrayList<>();
	   
	   public void addItem(Candy candy, CandyPackage candyPackage){
	       items.add(candy);
	       packages.add(candyPackage);
	       System.out.println(candy.getName() + " was added to cart.");
	   }
	   public void removeItem(Candy candy) {
		   int index = items.indexOf(candy);
		   if (index >= 0) {
			   items.remove(index);
			   packages.remove(index);
		   }
		}
	   public void viewCart(){
	       System.out.println("\nYour Cart: ");
	       double total = 0;
	       for (int i=0; i<items.size(); i++) {
	    	   Candy candy = items.get(i);
	    	   CandyPackage candyPackage = packages.get(i);
	    	   
	    	   double candyPrice = candy.getPrice();
	    	   double packagePrice = (candyPackage != null)? candyPackage.getPrice() : 0;
	    	   System.out.printf("* %s: $%.2f%s%n", candy.getName(), candyPrice, (candyPackage != null ? " + Packaging: $" + packagePrice: ""));
	    	   total += candyPrice + packagePrice;
	       }
	       System.out.printf("Total: $%.2f%n", total);
	   }
	   public List<Candy> getItems(){
	       return items;
	   }
	   public List<CandyPackage> getPackages(){
		   return packages;
	   }
}


public class BaseCandy implements Candy {
	private String name;
	private double price;
	private double weight;
	private int quantity;
	
	public BaseCandy(String name, double price, double weight, int quantity) {
		this.name = name;
		this.price = price;
		this.weight = weight;
		this.quantity = quantity;
	}
	@Override
	public String getName() {
		return name;
	}
	@Override
	public double getWeight() {
		return weight;
	}
	@Override
	public void setPrice(double price) {
		this.price = price;
	}
	@Override 
	public double getPrice() {
		return price;
	}
	@Override
	public int getQuantity() {
		return quantity;
	}
	@Override
	public void prepare() {
		System.out.println("Preparing " + name + "candies.");
	}
}


public class BaseCandyFactory implements CandyFactory{
	
	
	public BaseCandyFactory() {
		
	}
	@Override
	public Candy createCandy() {
		return new BaseCandy("Generic Candy", 1.20, .05, 12);
	}
	@Override
	public Candy createCandy(double price) {
		return new BaseCandy("Generic Candy", price, .05, 12);
	}
	@Override
	public CandyPackage createPackage() {
		return new BasicCandyPackage();
	}
}


public class BasicCandyPackage implements CandyPackage{
	private double price = .10;
	@Override
	public void pack(Candy candy) {
		System.out.println("Packing " + candy.getName() + " in a cleaar wrapper.");
	}
	@Override
	public double getPrice() {
		return price;
	}

}

//Uses polymorphism --allows for different types of candy to be handled
// Author: Kelly Payne 10/5/25
public interface Candy {
	String getName();
    double getWeight();
    double getPrice();
    int getQuantity();
    void prepare();
    void setPrice(double price); //added setter
}

//Author: Kelly Payne 10/5/25
// Abstract Factory Interface - declares methods
// to create families of related objects
public interface CandyFactory {
	Candy createCandy();
	Candy createCandy(double price);//candy price from CSV
    CandyPackage createPackage();
}

import java.util.ArrayList;
import java.io.InputStreamReader;
import java.io.InputStream;
import java.io.FileReader;
import java.util.List;
import com.opencsv.CSVReader;

public class CandyStore {
	private static CandyStore instance= null;
	private List<Candy> catalog = new ArrayList<>();
	private Inventory inventory = Inventory.getInstance();
	   
	   private CandyStore(){
		   loadInventFromCSV("data.csv");
	       
	   }
	   public void loadInventFromCSV(String filepath) {
		   try (InputStream input = CandyStore.class.getResourceAsStream("/data.csv")){
			   if (input == null) {
				   System.err.println("File not found in classpath: /data.csv");
				   loadDefaultCatalogAndInvent();
				   return;
			   }
		   
		   try (CSVReader reader = new CSVReader(new InputStreamReader(input))){
		   	   String[] line;
			   reader.readNext();
			   while ((line = reader.readNext()) != null) {
				   if (line.length < 4) {
					   continue; }
				   
				   String name = line[0].trim();
				   String type = line[1].trim();
				   double price = Double.parseDouble(line[2].trim());
				   int stock = Integer.parseInt(line[3].trim());
				   
				   double weight;
				   String lowerType = type.toLowerCase();
				   if (lowerType.contains("gummy")) {
					   weight = 0.05;
				   } else if (lowerType.contains("chocolate")) {
					   weight = .15;
				   } else if (lowerType.contains("hard")) {
					   weight = .10;
				   } else {
					   weight = .05; //default weight
				   }
				   Candy candy = createCandy(name, price, weight, stock);
				   catalog.add(candy);
				   inventory.addCandy(candy.getName(), stock);
				}
			  }
		   }catch (Exception e) {
			   System.err.println("Error loading data from CSV: " + e.getMessage());
			   e.printStackTrace();
			   loadDefaultCatalogAndInvent();
		  }
		   System.out.println("Load inventory: " + catalog.size() + " candies");
		}
	   
	   private Candy createCandy(String name, double price, double weight, int quantity) {
		   String lowerName = name.toLowerCase();
		   if (lowerName.contains("gummy")) {
			   return new GummyCandy(name, price, weight, quantity);
		   }else if (lowerName.contains("chocolate")) {
			   return new ChocolateCandy(name, price, weight, quantity);
		   }else if (lowerName.contains("hard")) {
			   return new HardCandy(name, price, weight, quantity);
		   }else {
			   return new BaseCandy(name, price, weight, quantity);
		   }
	   }
	   private void loadDefaultCatalogAndInvent() {
		   Candy gummy = new GummyCandy("Gummy Bear", 1.00, .05, 20);
		   Candy chocolate = new ChocolateCandy("Chocolate Bar", 1.50, .05, 25);
		   Candy hard = new HardCandy("Lollipop", .75,.05, 20);
		   catalog.add(gummy);
		   catalog.add(chocolate);
		   catalog.add(hard);
		   inventory.addCandy(gummy.getName(), 15);
		   inventory.addCandy(chocolate.getName(), 20);
		   inventory.addCandy(hard.getName(), 10);
	   }
	   public static CandyStore getInstance(){
	       if (instance == null){
	           instance = new CandyStore();
	       }
	       return instance;
	   }
	   public List<Candy> getCatalog(){
	       return catalog;
	   }
	   public List<InventoryItem> getInventory(){
	       List<InventoryItem> inventoryItems = new ArrayList<>();
	       for (Candy candy : catalog){
	           int qty = inventory.getStock(candy.getName());
	           inventoryItems.add(new InventoryItem(candy, qty));
	       }
	       return inventoryItems;
	   }
	   public InventoryItem getInventoryItemByIndex(int index){
	       List<InventoryItem> inventoryItems = getInventory();
	       if (index >= 0 && index < inventoryItems.size()){
	           return inventoryItems.get(index);
	       }
	       return null;
	   }
}

import java.util.List;
import java.util.Scanner;
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;

public class CandyStoreApp {

	public static void main(String[] args) {
		loadInventFromCSV("data.csv");
		CandyStore store = CandyStore.getInstance(); //Singleton Inventory
		System.out.println("DEBUG: catalog size = " + store.getCatalog().size());
		System.out.println("DEBUG: inventory size = " + store.getInventory().size());
        
		Catalog catalogView = new Catalog();   // View Catalog
        ShoppingCart cart = new ShoppingCart(); // User's Cart
        
        List<Customer> customers = List.of(
        new Customer("mary", "5432"),
        new Customer("william", "1234"));
        
        Scanner scanner = new Scanner(System.in);
        System.out.println("Welcome to the Candy Store!");
        System.out.print("Username: ");
        String username = scanner.nextLine();
        System.out.print("Password: ");
        String password = scanner.nextLine();
        
        Customer loginCustomer = null;
        boolean login = false;
        
        for (Customer customer : customers) {
        	if (customer.authenticate(username,  password)) {
        		loginCustomer = customer;
        		login = true;
        		break;
        	}
        }
        if (!login) {
        	System.out.println("Invalid login");
        	scanner.close();
        	return;
        }
        System.out.println("Logged in as: " + loginCustomer.getUsername());
        
        
        ConsoleUI  ui = new ConsoleUI(store, catalogView, cart);
        ui.run();
        
        boolean running = true;
        while (running){
        	System.out.println("\nAvailable Candy: ");
        	List<InventoryItem> inventoryItems = store.getInventory();
        	for (int i=0; i<inventoryItems.size(); i++) {
        		InventoryItem item = inventoryItems.get(i);
        		Candy candy = item.getCandy();
        		int qty = item.getQuantity();
        		System.out.printf("%d. %s - $%.2f (Stock: %d)%n", i + 1, candy.getName(), candy.getPrice(), qty);
        	}
            //catalogView.showCatalog(store.getInventory());
            System.out.print("\nEnter candy quantity to add to your cart (0 to checkout): ");
            int choice = scanner.nextInt();
            
            if (choice == 0){
                running = false;}
                else{
                    InventoryItem selectedItem = store.getInventoryItemByIndex(choice - 1);  
                    if (selectedItem != null && selectedItem.getQuantity()>0){
                        CandyFactory factory = getFactoryForCandy(selectedItem.getCandy());
                        Candy candy = factory.createCandy();
                        candy.setPrice(selectedItem.getCandy().getPrice());
                        CandyPackage pack = factory.createPackage();
                        
                        cart.addItem(candy, pack);//add candy to cart
                        
                        Inventory.getInstance().removeCandy(selectedItem.getCandy().getName(), 1);
                        System.out.println(selectedItem.getCandy().getName() + " was added to your cart.");
                    }else{
                            System.out.println("Invalid selection or out of stock");
                    }
            }
        }
        scanner.close();
        
        cart.viewCart();
        PricingCommand pricing = new RegPricingCommand();
        Checkout processor = new Checkout(pricing);
        processor.checkout(cart.getItems());
    }
    public static CandyFactory getFactoryForCandy(Candy candy){
        if (candy instanceof GummyCandy){
            return new GummyCandyFactory();
        }else if (candy instanceof ChocolateCandy){
            return new ChocolateCandyFactory();
        }else if (candy instanceof HardCandy){
            return new HardCandyFactory();
        }else {
            throw new IllegalArgumentException("No factory found for this candy: " + candy.getClass().getSimpleName());
        }

	}
    public static CandyFactory getFactoryForCandyType(String candyType) {
    	switch (candyType.toLowerCase()) {
    	case "gummy":
    	case "gummy candy":
    		return new GummyCandyFactory();
    	case "chocolate":
    	case "chocolate candy":
    		return new ChocolateCandyFactory();
    	case "hard":
    	case "hard candy":
    		return new HardCandyFactory();
    	default:
    		throw new IllegalArgumentException("No factory found for candy: " + candyType);
    	}
    }
    public static void loadInventFromCSV(String filename) {
        try (InputStream input = CandyStoreApp.class.getClassLoader().getResourceAsStream(filename)) {
            if (input == null) {
                System.out.println("File is not found in classpath: " + filename);
                return;
            }
            try (BufferedReader br = new BufferedReader(new InputStreamReader(input))) {
                String line;
                Inventory inventory = Inventory.getInstance();
                int totalAdded = 0;
                br.readLine();

                while ((line = br.readLine()) != null) {
                    String[] parts = line.split(",");
                    if (parts.length < 4) continue;

                    String name = parts[0].trim();
                    String type = parts[1].trim();

                    double price;
                    try {
                        price = Double.parseDouble(parts[2].trim());
                    } catch (NumberFormatException e) {
                        System.out.println("Invalid price value: " + parts[2]);
                        continue;
                    }
                    int quantity = Integer.parseInt(parts[3].trim());

                    CandyFactory factory = getFactoryForCandyType(type);
                    Candy candy = factory.createCandy();
                    candy.prepare();
                    for (int i = 0; i < quantity; i++) {
                        inventory.addCandy(name, 1);
                        totalAdded++;
                    }
                }
                System.out.println("Loaded inventory: " + totalAdded + "candies");
            }
        } catch (Exception e) {
            System.out.println("Error loading inventory: " + e.getMessage());
            e.printStackTrace();
        }
    }
}



// Author: Kelly Payne 10/5/25
public class ChocolateCandy implements Candy {
	private String name;
	private double price;
	private int quantity;
	private double weight;
	
	public ChocolateCandy(String name, double price, double weight, int quantity) {
		this.name = name;
		this.price = price;
		this.quantity = quantity;
		this.weight = weight;
	}
	@Override
    public String getName() {
        return name;
    }
    @Override
    public double getWeight(){
        return weight;
    }
    @Override
    public double getPrice(){ 
        return price;
    }
    @Override
    public void setPrice(double price) {
    	this.price = price;
    }
    @Override
    public void prepare(){ 
        System.out.println("Chocolate is melted and shaped into bars.");
    }
    @Override
    public int getQuantity() {
    	return quantity;
    }
    @Override
    public String toString(){
        return getName() + " $" + getPrice() + ", " + getWeight() + "grams";
    }
}


public class ChocolateCandyFactory implements CandyFactory{
	@Override
    public Candy createCandy(){
        return new BaseCandy("chocolate", 1.50, .05, 25);            
    }
	public Candy createCandy(double price) {
		return new BaseCandy("chocolate", price, .05, 25);
	}
    @Override
    public CandyPackage createPackage(){
        return new ChocolateBox();
    }
}

import java.util.Scanner;

public class ConsoleUI {
	private CandyStore store;
	private Catalog catalogView;
	private ShoppingCart cart;
	private Scanner scanner;

	public ConsoleUI(CandyStore store, Catalog catalogView, ShoppingCart cart) {
		this.store = store;
		this.catalogView = catalogView;
		this.cart = cart;
		this.scanner = new Scanner(System.in);
	}
	public void run() {
		boolean running = true;
		while (running) {
			catalogView.showCatalog(store.getInventory());
			System.out.print("\nEnter candy quantity to add to your cart (0 to checkout): ");
			int choice = scanner.nextInt();
		
			if (choice ==0) {
				running = false;}
			else {
				handleAddToCart(choice);
			}
	}
		cart.viewCart();
		PricingCommand pricing = new RegPricingCommand();
		Checkout processor = new Checkout(pricing);
		processor.checkout(cart.getItems());
	}
	private void handleAddToCart(int choice) {
		InventoryItem selectedItem = store.getInventoryItemByIndex(choice -1);
		if (selectedItem !=null && selectedItem.getQuantity()>0) {
			CandyFactory factory = getFactoryForCandy(selectedItem.getCandy());
			Candy candy = factory.createCandy();
			CandyPackage candyPackage = factory.createPackage();
		
			cart.addItem(candy, candyPackage);
			Inventory.getInstance().removeCandy(selectedItem.getCandy().getName(), 1);
			System.out.println(selectedItem.getCandy().getName() + " was added to your cart.");
		}else {
			System.out.println("Invalid selection or this item is out of stock.");
		}
	}

	private CandyFactory getFactoryForCandy(Candy candy) {
		if (candy instanceof GummyCandy) {
			return new GummyCandyFactory();
		} else if (candy instanceof ChocolateCandy) {
			return new ChocolateCandyFactory();
		} else if (candy instanceof HardCandy){
			return new HardCandyFactory();
		} else if (candy instanceof BaseCandy){
			return new BaseCandyFactory();
		} else {
			throw new IllegalArgumentException("No factory found for this candy: " + candy.getClass().getSimpleName());
		}
	}	
}

public class GummyBag implements CandyPackage {
	private double price = 2.00;
    @Override
    public void pack(Candy candy){
        System.out.println("Packing " + candy.getName() + " in clear plastic bag.");
    }
    @Override
    public double getPrice(){
        return price;
    }
}


public class GummyCandy implements Candy{
	private String name;
	private double price;
	private int quantity;
	private double weight;
	
	
	public GummyCandy(String name, double price, double weight, int quantity) {
		this.name = name;
		this.price = price;
		this.quantity = quantity;
		this.weight = weight;
	}
	@Override
    public String getName() {
        return name;
    }
    @Override
    public double getWeight(){
        return weight;
    }
    @Override
    public double getPrice(){ 
        return price;
    }
    @Override
    public void prepare(){
        System.out.println("This is soft candy.");
    }
    @Override
    public int getQuantity() {
    	return quantity;
    }
    @Override
    public void setPrice(double price) {
    	this.price = price; 
    }
    
}


public class GummyCandyFactory implements CandyFactory {
	@Override
    public Candy createCandy(){
        return new BaseCandy ("Gummy", 1.50, .05, 1);
    }
	@Override
	public Candy createCandy(double price) {
		return new BaseCandy("Gummy", price, .05, 25);
	}
    @Override
    public CandyPackage createPackage(){
        return new GummyBag();
    }

}

