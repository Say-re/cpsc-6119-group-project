classDiagram
    %% ========================================
    %% MODEL LAYER
    %% ========================================

    namespace Model {
        class Candy {
            <<interface>>
        }

        class Customer {
            -String customerId
            -String name
            -String email
            -String phone
            +Customer(id, name, email, phone)
            +getCustomerId() String
            +getName() String
            +getEmail() String
            +getPhone() String
        }

        class Order {
            -String orderId
            -String customerId
            -List~OrderItem~ items
            -OrderStatus status
            -Instant createdAt
            -Instant updatedAt
            -double totalAmount
            +Order(orderId, customerId)
            +addItem(item) void
            +getTotal() double
            +updateStatus(status) void
        }

        class OrderItem {
            -String productId
            -String productName
            -int quantity
            -double unitPrice
            -double subtotal
            +OrderItem(productId, name, qty, price)
            +getSubtotal() double
        }

        class OrderDisplayModel {
            -Order order
            -String customerName
            -String customerEmail
            +OrderDisplayModel(order, name, email)
            +getItemsSummary() String
            +getFormattedDate() String
        }

        class InventoryItem {
            -String productId
            -String name
            -int quantity
            -double price
            -String category
            +InventoryItem(id, name, qty, price, category)
            +getStockStatus() StockStatus
            +decreaseStock(amount) void
            +increaseStock(amount) void
        }

        class OrderStatus {
            <<enumeration>>
            PLACED
            PAID
            PACKING
            SHIPPED
            DELIVERED
            CANCELLED
            -String displayName
            -String backgroundColor
            -String textColor
            +getDisplayName() String
            +getBackgroundColor() String
            +getTextColor() String
        }

        class StockStatus {
            <<enumeration>>
            IN_STOCK
            LOW
            CRITICAL
            OUT_OF_STOCK
            -String displayName
            -String backgroundColor
            -String textColor
            +getDisplayName() String
            +getBackgroundColor() String
            +getTextColor() String
        }
    }

    %% Model Relationships
    Order "1" --o "many" OrderItem : contains
    Order --> OrderStatus : has status
    OrderDisplayModel --> Order : wraps
    OrderDisplayModel --> Customer : references
    InventoryItem --> StockStatus : has status

    %% ========================================
    %% PATTERN - COMMAND PATTERN
    %% ========================================

    namespace Patterns_Command {
        class DiscountCommand {
            <<interface>>
            +applyDiscount(order) void
        }

        class CouponCodeCommand {
            -String code
            -double discountAmount
            +CouponCodeCommand(code, amount)
            +applyDiscount(order) void
        }

        class PercentOff {
            -double percentage
            +PercentOff(percentage)
            +applyDiscount(order) void
        }
    }

    CouponCodeCommand ..|> DiscountCommand
    PercentOff ..|> DiscountCommand

    %% ========================================
    %% PATTERN - OBSERVER PATTERN
    %% ========================================

    namespace Patterns_Observer {
        class InventoryObserver {
            <<interface>>
            +onLowStock(productId, quantity) void
        }

        class InventorySubject {
            -List~InventoryObserver~ observers
            -int threshold
            +attach(observer) void
            +detach(observer) void
            +notifyObservers(productId, qty) void
            +checkAndNotify(productId, qty) void
        }
    }

    InventorySubject --> InventoryObserver : notifies

    %% ========================================
    %% PATTERN - SINGLETON PATTERN
    %% ========================================

    namespace Patterns_Singleton {
        class DataSource {
            <<singleton>>
            -String dataDirectory
            -DataSource INSTANCE
            -DataSource()
            +getInstance() DataSource
            +getDataDirectory() String
        }
    }

    %% ========================================
    %% REPOSITORY LAYER
    %% ========================================

    namespace Repository {
        class OrderDataManager {
            -String filePath
            +OrderDataManager()
            +loadOrders() List~Order~
            +saveOrder(order) void
            +updateOrder(order) void
            +getOrderById(id) Order
            +getOrdersByCustomer(customerId) List~Order~
        }

        class InventoryDataManager {
            -String filePath
            +InventoryDataManager()
            +loadInventory() List~InventoryItem~
            +saveInventory(items) void
            +getItemById(id) InventoryItem
            +updateItem(item) void
        }

        class CustomerDataManager {
            -String filePath
            +CustomerDataManager()
            +loadCustomers() List~Customer~
            +saveCustomer(customer) void
            +getCustomerById(id) Customer
        }
    }

    OrderDataManager ..> DataSource : uses
    InventoryDataManager ..> DataSource : uses
    CustomerDataManager ..> DataSource : uses
    OrderDataManager --> Order : manages
    InventoryDataManager --> InventoryItem : manages
    CustomerDataManager --> Customer : manages

    %% ========================================
    %% SERVICE LAYER
    %% ========================================

    namespace Service {
        class OrderService {
            -OrderDataManager orderDataManager
            -InventoryService inventoryService
            +OrderService()
            +createOrder(customerId, items) Order
            +updateOrderStatus(orderId, status) void
            +getOrdersByCustomer(customerId) List~Order~
            +applyDiscounts(order, commands) void
        }

        class InventoryService {
            -InventorySubject subject
            -InventoryDataManager dataManager
            -Map~String,Integer~ stockCache
            +InventoryService(subject)
            +getInventory() List~InventoryItem~
            +checkStock(productId) int
            +decreaseStock(productId, qty) boolean
            +increaseStock(productId, qty) void
            +getStockStatus(productId) StockStatus
        }

        class BackendFacade {
            <<facade>>
            -InventorySubject inventorySubject
            -InventoryService inventoryService
            -OrderService orderService
            -OrderDataManager orderDataManager
            +BackendFacade()
            +checkout(customerId, items) Order
            +ordersForUser(customerId) List~Order~
            +getInventory() List~InventoryItem~
            +reload() void
        }
    }

    OrderService --> OrderDataManager : uses
    OrderService --> InventoryService : uses
    OrderService ..> DiscountCommand : applies
    InventoryService --> InventorySubject : uses
    InventoryService --> InventoryDataManager : uses
    BackendFacade --> InventorySubject : manages
    BackendFacade --> InventoryService : delegates to
    BackendFacade --> OrderService : delegates to
    BackendFacade --> OrderDataManager : uses

    %% ========================================
    %% MANAGERS
    %% ========================================

    namespace Managers {
        class DashboardStatsManager {
            -OrderDataManager orderDataManager
            -CustomerDataManager customerDataManager
            -InventoryService inventoryService
            -Map~String,Double~ productPrices
            -StatsCache cache
            +DashboardStatsManager(orderDM, custDM, invSvc)
            +getTotalRevenue() double
            +getTotalOrders() int
            +getTotalCustomers() int
            +getLowStockCount() int
            +getRecentOrders(limit) List~OrderDisplayModel~
            +invalidateCache() void
        }

        class StatsCache {
            -Double totalRevenue
            -Integer totalOrders
            -Integer totalCustomers
            -Integer lowStockCount
            +isValid() boolean
            +clear() void
        }
    }

    DashboardStatsManager --> OrderDataManager : uses
    DashboardStatsManager --> CustomerDataManager : uses
    DashboardStatsManager --> InventoryService : uses
    DashboardStatsManager *-- StatsCache : contains

    %% ========================================
    %% AUTHENTICATION
    %% ========================================

    namespace Auth {
        class UserAccount {
            -String userId
            -String username
            -String email
            -String passwordHash
            -String salt
            -String role
            -String securityQuestion
            -String securityAnswerHash
            +UserAccount(username, email, hash, salt, role)
            +isAdmin() boolean
            +isCustomer() boolean
        }

        class UserManager {
            <<singleton>>
            -Map~String,UserAccount~ users
            -String filePath
            -UserManager INSTANCE
            -UserManager()
            +getInstance() UserManager
            +authenticate(username, password) UserAccount
            +registerUser(username, email, password, role) boolean
            +resetPassword(username, answer, newPassword) boolean
            +getAllUsers() List~UserAccount~
            +deleteUser(userId) boolean
            -hashPassword(password, salt) String
            -generateSalt() String
        }
    }

    UserManager --> UserAccount : manages

    %% ========================================
    %% UI LAYER - SCREENS
    %% ========================================

    namespace UI_Screens {
        class UIScreen {
            <<interface>>
            +getView() Pane
        }

        class AdminDashboard {
            -DashboardStatsManager statsManager
            -OrderDataManager orderDataManager
            -UserManager userManager
            -InventoryService inventoryService
            -BorderPane root
            +start(stage) void
            -createDashboard() BorderPane
            -createStatsPanel() HBox
            -createOrdersTab() VBox
            -createInventoryTab() VBox
            -createUsersTab() VBox
            -refreshStats() void
        }

        class LoginPage {
            -Stage stage
            +start(stage) void
            -createLoginView() VBox
            -createSignupView() VBox
            -handleLogin(username, password) void
            -handleSignup(username, email, password) void
            -openAdminDashboard() void
            -openCustomerDashboard(customer) void
        }

        class CustomerDashboard {
            -Customer customer
            -VBox dashboard
            -VBox cartBox
            +CustomerDashboard(customer)
            +getView() Pane
            -createDashboard() VBox
            -createHeader() HBox
            -createOrderHistory() VBox
            -createCart() VBox
        }

        class LoginScreen {
            -BorderPane root
            +LoginScreen()
            +getView() Pane
            -createLoginForm() VBox
            -handleLogin() void
        }
    }

    CustomerDashboard ..|> UIScreen
    LoginScreen ..|> UIScreen
    AdminDashboard --> DashboardStatsManager : uses
    AdminDashboard --> OrderDataManager : uses
    AdminDashboard --> UserManager : uses
    AdminDashboard --> InventoryService : uses
    LoginPage ..> UserManager : authenticates
    LoginPage ..> AdminDashboard : opens
    LoginPage ..> CustomerDashboard : opens
    CustomerDashboard --> Customer : displays

    %% ========================================
    %% UI LAYER - COMPONENTS
    %% ========================================

    namespace UI_Components {
        class StatsCard {
            -String title
            -String value
            -String icon
            +StatsCard(title, value, icon)
            -styleCard() void
        }

        class StatusBadge {
            -OrderStatus status
            +StatusBadge(status)
            -applyStyles() void
        }

        class StockStatusBadge {
            -StockStatus status
            +StockStatusBadge(status)
            -applyStyles() void
        }

        class OrderTableView {
            -DashboardStatsManager statsManager
            -TableColumn~OrderDisplayModel,String~ idColumn
            -TableColumn~OrderDisplayModel,String~ customerColumn
            -TableColumn~OrderDisplayModel,String~ totalColumn
            -TableColumn~OrderDisplayModel,String~ statusColumn
            -TableColumn~OrderDisplayModel,String~ dateColumn
            +OrderTableView(statsManager)
            -setupColumns() void
            -createStatusBadge(status) Label
            +refresh() void
        }

        class InventoryTableView {
            -InventoryService inventoryService
            -TableColumn~InventoryItem,String~ idColumn
            -TableColumn~InventoryItem,String~ nameColumn
            -TableColumn~InventoryItem,Integer~ quantityColumn
            -TableColumn~InventoryItem,Double~ priceColumn
            -TableColumn~InventoryItem,String~ statusColumn
            +InventoryTableView(inventoryService)
            -setupColumns() void
            -createStatusBadge(status) Label
            +refresh() void
        }

        class UserTableView {
            -UserManager userManager
            -TableColumn~UserAccount,String~ usernameColumn
            -TableColumn~UserAccount,String~ emailColumn
            -TableColumn~UserAccount,String~ roleColumn
            -TableColumn~UserAccount,String~ actionsColumn
            +UserTableView(userManager)
            -setupColumns() void
            -createActionButtons(user) HBox
            +refresh() void
        }
    }

    OrderTableView --> DashboardStatsManager : uses
    OrderTableView ..> StatusBadge : creates
    InventoryTableView --> InventoryService : uses
    InventoryTableView ..> StockStatusBadge : creates
    UserTableView --> UserManager : uses
    AdminDashboard ..> StatsCard : uses
    AdminDashboard ..> OrderTableView : uses
    AdminDashboard ..> InventoryTableView : uses
    AdminDashboard ..> UserTableView : uses

    %% ========================================
    %% PATTERN - FACTORY (UI BADGES)
    %% ========================================

    namespace UI_Factory {
        class BadgeFactory {
            <<abstract>>
            +createBadge(status)* Label
            #applyStyles(label, bg, text) void
        }

        class OrderStatusBadgeFactory {
            <<singleton>>
            -OrderStatusBadgeFactory INSTANCE
            -OrderStatusBadgeFactory()
            +getInstance() OrderStatusBadgeFactory
            +createBadge(status) Label
        }

        class StockStatusBadgeFactory {
            <<singleton>>
            -StockStatusBadgeFactory INSTANCE
            -StockStatusBadgeFactory()
            +getInstance() StockStatusBadgeFactory
            +createBadge(status) Label
        }
    }

    OrderStatusBadgeFactory --|> BadgeFactory
    StockStatusBadgeFactory --|> BadgeFactory
    OrderTableView ..> OrderStatusBadgeFactory : uses
    InventoryTableView ..> StockStatusBadgeFactory : uses

    %% ========================================
    %% UTILITIES
    %% ========================================

    namespace Utilities {
        class ColorConstants {
            <<utility>>
            +STATUS_PENDING_BG String
            +STATUS_PENDING_TEXT String
            +STATUS_PROCESSING_BG String
            +STATUS_PROCESSING_TEXT String
            +STATUS_IN_TRANSIT_BG String
            +STATUS_IN_TRANSIT_TEXT String
            +STATUS_COMPLETED_BG String
            +STATUS_COMPLETED_TEXT String
            +STATUS_CANCELLED_BG String
            +STATUS_CANCELLED_TEXT String
            +STOCK_IN_STOCK_BG String
            +STOCK_IN_STOCK_TEXT String
            +STOCK_LOW_BG String
            +STOCK_LOW_TEXT String
            +STOCK_CRITICAL_BG String
            +STOCK_CRITICAL_TEXT String
        }

        class CsvUtil {
            <<utility>>
            +readCsv(filePath) List~String[]~
            +writeCsv(filePath, data) void
            +parseLine(line) String[]
        }

        class DateFormatter {
            <<utility>>
            +formatDate(instant) String
            +formatDateTime(instant) String
            +parseDate(str) Instant
        }
    }

    OrderStatus ..> ColorConstants : uses
    StockStatus ..> ColorConstants : uses
    OrderDataManager ..> CsvUtil : uses
    InventoryDataManager ..> CsvUtil : uses
    CustomerDataManager ..> CsvUtil : uses
    UserManager ..> CsvUtil : uses
    OrderDisplayModel ..> DateFormatter : uses

    %% ========================================
    %% LEGACY SYSTEM (SIMPLIFIED)
    %% ========================================

    namespace Legacy {
        class CandyFactory_Legacy {
            <<interface>>
            +createCandy() Candy_Legacy
            +createPackage() CandyPackage_Legacy
        }

        class Candy_Legacy {
            <<interface>>
            +getName() String
            +getPrice() double
        }

        class CandyPackage_Legacy {
            <<interface>>
            +getType() String
            +getCost() double
        }

        class ChocolateCandyFactory {
            +createCandy() Candy_Legacy
            +createPackage() CandyPackage_Legacy
        }

        class GummyCandyFactory {
            +createCandy() Candy_Legacy
            +createPackage() CandyPackage_Legacy
        }

        class HardCandyFactory {
            +createCandy() Candy_Legacy
            +createPackage() CandyPackage_Legacy
        }

        class ShoppingCart {
            -List~Candy_Legacy~ items
            -List~CandyPackage_Legacy~ packages
            +addItem(candy) void
            +removeItem(candy) void
            +getTotal() double
        }

        class CartCommand_Legacy {
            <<interface>>
            +execute() void
        }

        class AddItemCommand_Legacy {
            -ShoppingCart cart
            -Candy_Legacy candy
            -int quantity
            +execute() void
        }

        class RemoveItemCommand_Legacy {
            -ShoppingCart cart
            -Candy_Legacy candy
            -int quantity
            +execute() void
        }
    }

    ChocolateCandyFactory ..|> CandyFactory_Legacy
    GummyCandyFactory ..|> CandyFactory_Legacy
    HardCandyFactory ..|> CandyFactory_Legacy
    AddItemCommand_Legacy ..|> CartCommand_Legacy
    RemoveItemCommand_Legacy ..|> CartCommand_Legacy
    AddItemCommand_Legacy --> ShoppingCart : modifies
    RemoveItemCommand_Legacy --> ShoppingCart : modifies
    ShoppingCart --> Candy_Legacy : contains
    ShoppingCart --> CandyPackage_Legacy : contains

    %% ========================================
    %% CROSS-CUTTING RELATIONSHIPS
    %% ========================================

    LoginPage ..> BackendFacade : uses
    CustomerDashboard ..> BackendFacade : uses
    AdminDashboard ..> InventoryObserver : implements
